<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LiftLab</title>
  <link rel="icon" type="image/x-icon" href="https://logodix.com/logo/2051355.png">
  <link rel="stylesheet" href="style.css" />
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar">
  <div class="logo" id="logoHome">üèãÔ∏è LiftLab</div>
  <div class="nav-buttons">
    <button id="loginBtnNav" class="nav-btn">Login</button>
    <button id="signupBtnNav" class="nav-btn outline">Sign Up</button>
    <button id="logoutBtnNav" class="nav-btn logout" style="display:none;">Logout</button>
    <button id="logoutBtnBottom" class="logout-btn bottom-logout" style="display:none;">
  Logout
</button>

    
  </div>
</nav>

<!-- ================= HOME PAGE ================= -->
<div id="homePage">

  <!-- HERO -->
  <section class="hero">
    <div class="hero-overlay">
      <h1>Train Smarter. Lift Stronger.</h1>
      <p>Modern strength training for schools</p>
    </div>
  </section>

  <!-- INFO CARDS -->
  <section class="info">
    <div class="info-card">
      <img src="https://picsum.photos/300/200?1">
      <h3>Structured Programs</h3>
      <p>Instructor-built workouts with schedules.</p>
    </div>
    <div class="info-card">
      <img src="https://picsum.photos/300/200?2">
      <h3>Exercise Videos</h3>
      <p>Watch exactly how each lift is performed.</p>
    </div>
    <div class="info-card">
      <img src="https://picsum.photos/300/200?3">
      <h3>Track Progress</h3>
      <p>Log sets, reps, and weights easily.</p>
    </div>
    <div class="info-card">
      <img src="https://picsum.photos/300/200?2">
      <h3>Exercise Videos</h3>
      <p>Watch exactly how each lift is performed.</p>
    </div>
  </section>

  <!-- ZIGZAG INFO -->
  <section class="info-zigzag">

    <div class="info-row reveal reveal-left">
      <div class="info-text">
        <h2>Built for School Weight Rooms</h2>
        <p>LiftLab was designed specifically for school environments ‚Äî not commercial gyms.
Instructors can manage multiple classes, assign structured workouts, and ensure
students train safely and consistently.</p>
        <p>Whether it‚Äôs PE, strength & conditioning, or athletic development, LiftLab keeps
everything organized and easy to manage.</p>
      </div>
      <div class="info-image">
        <img src="https://picsum.photos/600/400?strength1">
      </div>
    </div>

    <div class="info-row reverse reveal reveal-right">
      <div class="info-text">
        <h2>Video-Guided Exercises</h2>
        <p>Every workout can include exercise demonstration videos so students always know
exactly how each movement should be performed.</p>
        <p>This reduces confusion, improves technique, and helps prevent injury ‚Äî especially
for beginners who are new to lifting.</p>
      </div>
      <div class="info-image">
        <img src="https://picsum.photos/600/400?strength2">
      </div>
    </div>

    <div class="info-row reveal reveal-left">
      <div class="info-text">
        <h2>Track Progress Over Time</h2>
        <p>Students log the weight they use for each workout, creating accountability and
encouraging effort.</p>
        <p>Instructors can review workout completion, monitor trends, and ensure students are
actually following the program instead of guessing or skipping work.</p>
      </div>
      <div class="info-image">
        <img src="https://picsum.photos/600/400?strength3">
      </div>
    </div>
<div class="info-row reverse reveal reveal-right">
      <div class="info-text">
        <h2>Video-Guided Exercises</h2>
        <p>Instructors can see exactly who completed each workout, what weights were used,
and which students may need extra guidance.</p>
        <p>Students can also leave comments or questions, allowing instructors to provide
feedback and support ‚Äî all in one place.</p>
      </div>
      <div class="info-image">
        <img src="https://picsum.photos/600/400?strength4">
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="cta-section reveal">
    <div class="cta-content">
      <h2>Bring Structure to Your Weight Room</h2>
      <p>Everything students and instructors need ‚Äî in one platform.</p>
      <button id="ctaGetStarted" class="cta-btn">Get Started</button>
    </div>
  </section>

</div>

<!-- ================= AUTH PAGE ================= -->
<div id="authPage" style="display:none; min-height:100vh; padding-top:140px;">

  <section class="card auth-card">
    <h2>Login / Sign Up</h2>

    <input type="text" id="fullName" placeholder="First Name">
    <input type="text" id="lastname" placeholder="Last Name">

    <input type="email" id="email" placeholder="School Email">
    <input type="password" id="password" placeholder="Password">

<select id="roleSelect">
  <option value="student">Student</option>
  <option value="instructor">Instructor</option>
</select>

    <button id="loginBtn">Login</button>
    <button id="signupBtn" class="outline">Sign Up</button>

    <button id="backHomeBtn" class="nav-btn outline" style="margin-top:20px;">
      ‚Üê Back to Home
    </button>
  </section>

</div>

<!-- ================= DASHBOARD ================= -->
<!--Student Side-->



<section id="dashboard" style="display:none; padding-top:140px;">
<!-- STUDENT SECTION -->
 <section id="studentSection" style="display:none;">

  <!-- HELLO -->
  <h2 id="studentGreeting" class="greeting-title"></h2>

  <!-- JOIN CLASS CARD -->
  <section class="card">
    <h2 class="big-header">Join a Class</h2>
    <input id="joinClassId" placeholder="Enter Class ID">
    <button id="joinClassBtn">Join Class</button>
    <p id="joinStatus"></p>
  </section>

  <!-- WORKOUTS CARD -->
  <section class="card">
    <h1><center>Classes</center></h1>
    <h2 id="studentClassTitle" style="display:none;"></h2>
    <div id="studentWorkoutList"></div>
  </section>

  <!-- COMMENTS CARD -->
  <section class="card">
    <h3>Comments for Instructor</h3>
    <textarea id="commentText" placeholder="Ask a question or leave feedback"></textarea>
    <button id="postCommentBtn">Post Comment</button>
    <div id="commentStatus"></div>
  </section>

</section>
<!-- INSTRUCTOR SECTION -->
  <section id="instructorSection" style="display:none;">

  <!-- HELLO -->
  <h2 id="instructorGreeting" class="greeting-title"></h2>

  <!-- CREATE CLASS -->
  <section class="card">
    <h3>Create Class</h3>
    <input type="text" id="className" placeholder="Class Name">
    <button id="createClassBtn">Create Class</button>
    <p id="classStatus"></p>
  </section>

  <!-- CREATE WORKOUT -->
  <section class="card">
    <h3>Create Workout</h3>
    <input id="workoutTitle" placeholder="Workout Name">
    <input id="exerciseName" placeholder="Exercise Name">
    <input id="sets" type="number" placeholder="Sets">
    <input id="reps" type="number" placeholder="Reps">
    <input id="videoUrl" placeholder="Exercise Video URL">

    <select id="classSelect">
      <option value="">Save for later (no class)</option>
    </select>

    <button id="saveWorkoutBtn">Save Workout</button>
    <p id="workoutStatus"></p>
  </section>

  <!-- WORKOUT LIST -->
  <section class="card">
    <h3>Your Workouts</h3>
    <div id="workoutList"></div>
  </section>

  <!-- CLASS LIST -->
  <section class="card">
    <h3>Your Classes</h3>
    <div id="classList"></div>
  </section>

  <section class="card">
<h3>Student Workout Logs</h3>
<div id="logList"></div>
  </section>

</section>

</section>




<!-- FOOTER -->
<footer class="site-footer">
  <div class="footer-content">
    <div class="footer-contact">
      <h4>Lift Lab</h4>
      <p>3592 Corporate Dr, Columbus, OH</p>
      <p>Email: student.ngirmay56@hsach.org</p>
    </div>
    <div class="footer-links">
      <p>¬© 2026 LiftLab</p>
    </div>
  </div>
</footer>

<!-- ================= SCRIPT ================= -->
<script type="module">

/* PAGE SWITCHING */
const homePage = document.getElementById("homePage");
const authPage = document.getElementById("authPage");
const dashboard = document.getElementById("dashboard");

function showAuthPage() {
  homePage.style.display = "none";
  dashboard.style.display = "none";
  authPage.style.display = "block";
  navbar.classList.add("auth-nav");
  window.scrollTo(0,0);
}

function showHomePage() {
  authPage.style.display = "none";
  dashboard.style.display = "none";
  homePage.style.display = "block";
  navbar.classList.remove("auth-nav");
  window.scrollTo(0,0);
}


const logoHome = document.getElementById("logoHome");

logoHome.addEventListener("click", () => {
  showHomePage();
});


/* NAV BUTTONS */
loginBtnNav.onclick = showAuthPage;
signupBtnNav.onclick = showAuthPage;
ctaGetStarted.onclick = showAuthPage;
backHomeBtn.onclick = showHomePage;

/* FIREBASE */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, serverTimestamp, collection, addDoc, deleteDoc, updateDoc, arrayUnion, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";



const firebaseConfig = {
  apiKey: "AIzaSyDt8d3VKJcAeyFMMzfiT93mdwLiWYNxzx4",
  authDomain: "weightlifting-app-3c288.firebaseapp.com",
  projectId: "weightlifting-app-3c288",
  storageBucket: "weightlifting-app-3c288.firebasestorage.app",
  messagingSenderId: "410023900029",
  appId: "1:410023900029:web:9684c383341bfd2e075214"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* AUTH */
loginBtn.onclick = async () => {
  await signInWithEmailAndPassword(auth, email.value, password.value);
};


const fullName = document.getElementById("fullName");
const roleSelect = document.getElementById("roleSelect");

signupBtn.onclick = async () => {
  const cred = await createUserWithEmailAndPassword(
    auth,
    email.value,
    password.value
  );

  await setDoc(doc(db, "users", cred.user.uid), {
    name: fullName.value,
    email: email.value,
    role: roleSelect.value
  });
};

saveWorkoutBtn.onclick = async () => {
  const user = auth.currentUser;
  if (!user) return;

  await addDoc(collection(db, "workouts"), {
    title: workoutTitle.value,
    exercise: exerciseName.value,
    sets: Number(sets.value),
    reps: Number(reps.value),
    videoUrl: videoUrl.value,
    instructorId: user.uid,
    classId: classSelect.value || null,
    createdAt: serverTimestamp()
  });
workoutStatus.textContent = "Workout saved!";
  loadInstructorData();
};
logoutBtnNav.onclick = async () => {
  await signOut(auth);

  // hard reset UI
  studentSection.style.display = "none";
  instructorSection.style.display = "none";
  dashboard.style.display = "none";

  studentWorkoutList.innerHTML = "";
  studentClassTitle.style.display = "none";
  joinStatus.textContent = "";

  showHomePage();
};

const logList = document.getElementById("logList");

/* AUTH STATE */
onAuthStateChanged(auth, async (user) => {
  async function loadStudentIfJoined(user) {
  const snap = await getDoc(doc(db, "users", user.uid));
  const joinedClass = snap.data()?.joinedClass;
  



  if (joinedClass) {
    loadStudentClass(joinedClass);
  }
}

  if (user) {
    loginBtnNav.style.display = "none";
    signupBtnNav.style.display = "none";
    logoutBtnNav.style.display = "inline-block";
    

    homePage.style.display = "none";
    authPage.style.display = "none";
    dashboard.style.display = "block";

    const snap = await getDoc(doc(db, "users", user.uid));
    const role = snap.data().role;
    const userName = snap.data().name;

if (role === "student") {
  document.getElementById("studentGreeting").textContent =
    `Hello, ${userName}`;
}

if (role === "instructor") {
  document.getElementById("instructorGreeting").textContent =
    `Hello, ${userName}`;
}


  instructorSection.style.display = role === "instructor" ? "block" : "none";
  studentSection.style.display = role === "student" ? "block" : "none";

if (role === "instructor") {
  instructorSection.style.display = "block";
  loadInstructorData();
  loadWorkoutLogs(); // ‚úÖ RIGHT HERE
}

if (role === "student") {
  loadStudentIfJoined(user);
}


  } else {
  logoutBtnNav.style.display = "none";
  loginBtnNav.style.display = "inline-block";
  signupBtnNav.style.display = "inline-block";

  studentSection.style.display = "none";
  instructorSection.style.display = "none";
  dashboard.style.display = "none";

  showHomePage();
}

});
async function loadWorkoutLogs() {
  const user = auth.currentUser;
  if (!user) return;

  logList.innerHTML = "";

  const classesSnap = await getDocs(
    query(collection(db, "classes"), where("instructorId", "==", user.uid))
  );

  if (classesSnap.empty) {
    logList.innerHTML = "<em>No student logs yet</em>";
    return;
  }

  for (const classDoc of classesSnap.docs) {
    const logsSnap = await getDocs(
      query(
        collection(db, "workoutLogs"),
        where("classId", "==", classDoc.id),
        orderBy("completedAt", "desc")
      )
    );

    logsSnap.forEach(docu => {
      const log = docu.data();

      logList.innerHTML += `
        <div class="log-card">
          <strong>${log.studentName}</strong><br>
          Class: ${classDoc.data().name}<br>
          Workout: ${log.workoutTitle}<br>
          Weight: ${log.weight} lbs
        </div>
      `;
    });
  }
}

/* NAVBAR SCROLL EFFECT */
const navbar = document.querySelector(".navbar");
window.addEventListener("scroll", () => {
  navbar.classList.toggle("scrolled", window.scrollY > 40);
});

/* REVEALS */
const reveals = document.querySelectorAll(".reveal");
window.addEventListener("scroll", () => {
  reveals.forEach(el => {
    if (el.getBoundingClientRect().top < window.innerHeight - 120) {
      el.classList.add("active");
    }
  });
});

/* CREATE CLASS */
const classNameInput = document.getElementById("className");
const createClassBtn = document.getElementById("createClassBtn");
const classStatus = document.getElementById("classStatus");

createClassBtn.addEventListener("click", async () => {
  const className = classNameInput.value.trim();
  const user = auth.currentUser;

  if (!className) {
    alert("Enter a class name");
    return;
  }

  try {
    const classRef = await addDoc(collection(db, "classes"), {
      name: className,
      instructorId: user.uid,
      createdAt: serverTimestamp()
    });

classStatus.textContent = `Class "${classNameInput.value}" created`;

    // Save classId to instructor user profile
    await setDoc(doc(db, "users", user.uid), {
      classId: classRef.id
    }, { merge: true });

  } catch (error) {
    alert(error.message);
  }
});


joinClassBtn.onclick = async () => {
  const classId = joinClassId.value.trim();
  const user = auth.currentUser;

  if (!classId) return;

  try {
    const classRef = doc(db, "classes", classId);
    const classSnap = await getDoc(classRef);

    if (!classSnap.exists()) {
      joinStatus.textContent = "Class not found";
      return;
    }

    await updateDoc(doc(db, "users", user.uid), {
      joinedClass: classId
    });

    joinStatus.textContent = "Joined class!";
    loadStudentClass(classId);

  } catch (err) {
    joinStatus.textContent = err.message;
  }
};

async function loadStudentClass(classId) {
  const classSnap = await getDoc(doc(db, "classes", classId));

  studentClassTitle.style.display = "block";
  studentClassTitle.textContent = classSnap.data().name;

  studentWorkoutList.innerHTML = "";

  const q = query(
    collection(db, "workouts"),
    where("classId", "==", classId)
  );

  const snap = await getDocs(q);

  snap.forEach(docu => {
    const w = docu.data();

    const videoId = w.videoUrl.split("v=")[1]?.split("&")[0];
const embedUrl = videoId
  ? `https://www.youtube.com/embed/${videoId}`
  : null;


    studentWorkoutList.innerHTML += `
      <div class="workout-card">
        <h4>${w.title}</h4>
        <p>${w.exercise} ‚Äî ${w.sets}x${w.reps}</p>

        ${embedUrl ? `
          <div class="video-wrapper">
            <iframe
  src="${embedUrl}"
  frameborder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowfullscreen>
</iframe>

          </div>
          <a href="${w.videoUrl}" target="_blank" class="video-link">
            Workout Video
          </a>
        ` : ""}

        <input
          type="number"
          placeholder="Weight used (lbs)"
          class="weight-input"
          id="weight-${docu.id}"
        >

        <button
          class="complete-btn"
          onclick="completeWorkout('${docu.id}', '${w.title}')"
        >
          Mark Complete
        </button>

        <p class="complete-status" id="status-${docu.id}"></p>
      </div>
    `;
  });
}


postCommentBtn.onclick = async () => {
  const user = auth.currentUser;
  const text = commentText.value;

  if (!text) return;

  const userSnap = await getDoc(doc(db, "users", user.uid));

  await addDoc(collection(db, "comments"), {
    classId: userSnap.data().joinedClass,
    userId: user.uid,
    userName: userSnap.data().name,
    text,
    createdAt: serverTimestamp()
  });

  commentText.value = "";
  commentStatus.textContent = "Comment sent!";
};


async function loadInstructorData() {
  const user = auth.currentUser;
  if (!user) return;

  // CLASSES
  classList.innerHTML = "";
  classSelect.innerHTML = `<option value="">Save for later (no class)</option>`;
  const classSnap = await getDocs(
    query(collection(db, "classes"), where("instructorId", "==", user.uid))
  );

  classSnap.forEach(c => {
    classList.innerHTML += `
  <div class="workout-card">
    <strong>${c.data().name}</strong><br>
    <small>${c.id}</small>

    <div id="students-${c.id}" style="margin-top:10px;"></div>

    <button onclick="loadStudents('${c.id}')">View Students</button>
    <button onclick="deleteClass('${c.id}')">Delete Class</button>
  </div>
`;


    classSelect.innerHTML += `
  <option value="${c.id}">
    ${c.data().name}
  </option>
`;

  });
  
  


window.deleteClass = async (classId) => {
  if (!confirm("Delete this class? This cannot be undone.")) return;

  await deleteDoc(doc(db, "classes", classId));

  loadInstructorData();
};
window.deleteWorkout = async (workoutId) => {
  if (!confirm("Delete this workout?")) return;

  await deleteDoc(doc(db, "workouts", workoutId));

  loadInstructorData();
};


window.loadStudents = async (classId) => {
  const container = document.getElementById(`students-${classId}`);
  container.innerHTML = "<em>Loading...</em>";

  const snap = await getDocs(
    query(collection(db, "users"), where("joinedClass", "==", classId))
  );

  if (snap.empty) {
    container.innerHTML = "<em>No students yet</em>";
    return;
  }

  container.innerHTML = snap.docs
    .map(u => `<div>üë§ ${u.data().name}</div>`)
    .join("");
};

  


  // WORKOUTS
  workoutList.innerHTML = "";
  const workoutSnap = await getDocs(
    query(collection(db, "workouts"), where("instructorId", "==", user.uid))
  );

  workoutSnap.forEach(w => {
    workoutList.innerHTML += `
  <div class="workout-card">
    <strong>${w.data().title}</strong><br>
    ${w.data().exercise} ‚Äî ${w.data().sets}x${w.data().reps}<br><br>
    <button onclick="deleteWorkout('${w.id}')">Delete Workout</button>
  </div>
`;

  });
}
window.completeWorkout = async (workoutId, workoutTitle) => {
  const user = auth.currentUser;
  const weightInput = document.getElementById(`weight-${workoutId}`);
  const status = document.getElementById(`status-${workoutId}`);

  const weight = weightInput.value;
  if (!weight) {
    status.textContent = "Enter weight used";
    return;
  }

  const userSnap = await getDoc(doc(db, "users", user.uid));
  const classId = userSnap.data().joinedClass;

  // üëá THIS is where studentId_workoutId exists
  const logId = `${user.uid}_${workoutId}`;
  const logRef = doc(db, "workoutLogs", logId);

  await setDoc(logRef, {
    workoutId,
    workoutTitle,
    classId,
    studentId: user.uid,
    studentName: userSnap.data().name,
    weight,
    completedAt: serverTimestamp()
  }, { merge: true });

  status.textContent = "Workout logged ‚úÖ";
};


</script>

</body>
</html>
